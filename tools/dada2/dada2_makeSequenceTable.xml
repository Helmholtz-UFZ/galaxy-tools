<tool id="dada2_makeSequenceTable" name="dada2: makeSequenceTable" version="@DADA2_VERSION@">
    <description>construct a sequence table (analogous to OTU table)</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <exmand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
    Rscript '$dada2_script'
    ]]></command>
    <configfiles>
        <configfile name="dada2_script"><![CDATA[
library(dada2, quietly=T)

samples <- list()
#for $s in $samples:
    #if $s.is_of_type('dada.derep') or $s.is_of_type('dada2.dada')
	samples[['$s.element_identifier']] <- readRDS('$s')
	#else
	samples[['$s.element_identifier']] <- read.table('$s', header=T, sep="\t")
	#end if
#end for
st <- makeSequenceTable(samples, orderBy = "$orderby")
##saveRDS(st, file='$stable')
write.table(st, "$stable", quote=F, sep="\t", row.names = T, col.names = NA)
    ]]></configfile>
    </configfiles>
    <inputs>
        <param name="samples" type="data" multiple="true" format="@DADA_UNIQUES@" label="samples" />
        <param name="orderby" type="select" label="Column order">
            <option value="abundance">abundance</option>
            <option value="nsamples">nsamples</option>
        </param>
    </inputs>
    <outputs>
        <data name="stable" format="dada2.sequencetable" label="${tool.name} on ${on_string}"/>
    </outputs>

    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <expand macro="citations"/>
</tool>
