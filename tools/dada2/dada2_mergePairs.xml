<tool id="dada2_mergePairs" name="dada2: mergePairs" version="@DADA2_VERSION@">
    <description>Merge denoised forward and reverse reads</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <expand macro="version_command"/>
    <command detect_errors="exit_code"><![CDATA[
    Rscript '$dada2_script'
    ]]></command>
    <configfiles>
        <configfile name="dada2_script"><![CDATA[
library(dada2, quietly=T)

dadaF <- readRDS(file.path('$dadaf'))
dadaR <- readRDS(file.path('$dadar'))
derepF <- readRDS(file.path('$derepf.extra_files_path',"Rdata"))
derepR <- readRDS(file.path('$derepr.extra_files_path',"Rdata"))

merged <- mergePairs(dadaF, derepF, dadaR, derepR, minOverlap = $minoverlap, maxMismatch = $maxmismatch,
    returnRejects = FALSE, propagateCol = character(0),
    justConcatenate = $justconcatenate, trimOverhang = $trimoverhang)

##saveRDS(merged, file='$merged')
##For display in Galaxy this could be transposed (..but the user could also do it herself)
write.table(merged, "$merged", quote=F, sep="\t", row.names = F, col.names = T)
    ]]></configfile>
    </configfiles>
    <inputs>
        <param name="dadaf" type="data" format="dada2_dada" label="dada results for forward reads"/>
        <param name="derepf" type="data" format="dada2_derep" label="dereplicated forward reads"/>
        <param name="dadar" type="data" format="dada2_dada" label="dada results for reverse reads"/>
        <param name="derepr" type="data" format="dada2_derep" label="dereplicated reverse reads"/>
        <param name="minoverlap" type="integer" value="12" min="0" label="minimum length of the overlap"/>
        <param name="maxmismatch" type="integer" value="0" min="0" label="maximum number of mismatches"/>
        <param name="justconcatenate" type="boolean" checked="false" truevalue="FALSE" falsevalue="FALSE" label="concatenated rather than merge"/>
        <param name="trimoverhang" type="boolean" checked="false" truevalue="FALSE" falsevalue="FALSE" label="trim overhangs"/>
    </inputs>
    <outputs>
        <data name="merged" format="dada2_mergepairs" label="${tool.name} on ${on_string}"/>
    </outputs>

    <help><![CDATA[
        TODO: Fill in help.
    ]]></help>
    <expand macro="citations"/>
</tool>
