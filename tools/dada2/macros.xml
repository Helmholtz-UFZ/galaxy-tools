<?xml version="1.0"?>
<macros>
    <xml name="requirements">
        <requirements>
            <requirement type="package" version="@DADA2_VERSION@">bioconductor-dada2</requirement>
            <yield/>
        </requirements>
    </xml>

    <token name="@DADA2_VERSION@">1.10.0</token>
    <token name="@WRAPPER_VERSION@">0</token>
    
    <xml name="version_command">
        <version_command><![CDATA[
echo $(R --version | grep version | grep -v GNU)", dada2 version" $(R --vanilla --slave -e "library(dada2); cat(sessionInfo()\$otherPkgs\$dada2\$Version)" 2> /dev/null | grep -v -i "WARNING: ")
        ]]></version_command>
    </xml>

    <xml name="citations">
        <citations>
            <citation type="doi">10.1038/nmeth.3869</citation>
        </citations>
    </xml>

    <token name="@DADA_UNIQUES@">dada2_derep,dada2_dada,dada2_mergepairs</token>

    <token name="@READ_FOO@"><![CDATA[
    #def read_data($dataset)
        #if $dataset.is_of_type('dada2_derep')
            readRDS(file.path('$dataset.extra_files_path', 'Rdata'))
        #else if $dataset.is_of_type('dada2_dada')
            readRDS('$dataset')
        #else if $dataset.is_of_type('dada2_sequencetable')
            as.matrix( read.table('$dataset', header=T, sep="\t", row.names=1) )
        #else if $dataset.is_of_type('dada2_mergepairs')
              read.table('$dataset', header=T, sep="\t" )
        #else if $dataset.is_of_type('tabular')
              read.table('$dataset', header=T, sep="\t", row.names=1 )
        #else
            #raise Exception("error: unknown input type")
        #end if
    #end def
    ]]></token>
    <!-- for filterAndTrim --> 
	<xml name="trimmers">
        <section name="trim" title="Trimming parameters">
            <param name="truncQ" type="integer" value="2" min="0" label="Truncate reads at quality threshold" help="Truncate reads at the first instance of a quality score less than or equal to this threshold"/>
            <param name="trimLeft" type="integer" value="0" min="0" label="Trim start of each read" help="The number of nucleotides to remove from the start of each read."/>
    		<param name="trimRight" type="integer" value="0" min="0" label="Trim end of each read" help="The number of nucleotides to remove from the end of each read"/>
            <param name="truncLen" type="integer" value="0" min="0" label="Truncate read length" help="Truncate reads after this amount of bases. Reads shorter than this are discarded."/>
		</section>
    </xml>
    <xml name="filters">
        <section name="filter" title="Filtering parameters">
            <param name="maxLen" type="integer" value="" optional="true" min="0" label="Remove long reads" help="Remove reads with length greater than this value. Default: no length threshold"/>
            <param name="minLen" type="integer" value="20" min="0" label="Remove short reads" help="Remove reads with length less than this value. Default: 20"/>
            <param name="maxN" type="integer" value="0" min="0" label="Remove reads with more Ns" help="Note that some of the subsequent dada pipeline steps do not allow Ns"/>
            <param name="minQ" type="integer" value="0" min="0" label="Remove low quality reads" help="Reads contain a quality score less than this value will be discarded"/>
            <param name="maxEE" type="integer" value="" optional="true" min="0" label="Remove reads by number expected errors" help="Reads with a higher number of expected errors (EE) will be discarded, where EE = sum(10^(-Q_i/10)), with Q are the nominal quality scores at the read positions"/>
        </section>
    </xml>

    <xml name="errorEstimationFunction">
        <param name="errfoo" type="select" label="Error function">
            <option value="loessErrfun">loess</option>
            <option value="noqualErrfun">noqual</option>
            <option value="PacBioErrfun">PacBio</option>
        </param>
    </xml>


</macros>
