<tool id="dfpl_predict_gnn" name="deepFPlearn predict gnn" version="@TOOL_VERSION@+galaxy0" profile="23.0">
    <description>association of molecular structures to biological targets</description>
    <creator>
        <organization name="Helmholtz Centre for Environmental Research - UFZ, Research Data Management"
                      url ="https://www.ufz.de/index.php?en=45348"/>
    </creator>
    <macros>
        <import>macros.xml</import>
    </macros>                                               
    <expand macro="requirements"/>                          
    <command detect_errors="exit_code"><![CDATA[
        set -o pipefail;
        cat '$inputs'
        | python '$__tool_directory__/json_flatten.py'
        | python '$__tool_directory__/json_predict_gnn.py'
        > config.json &&
        dfpl predictgnn --configFile config.json      

    ]]></command>
    <configfiles>
        <inputs name="inputs" data_style="paths"/> 
    </configfiles>
    <inputs>
        <!-- multiple inputs?:  (checkpoints_pathS) smiles_columns !!! , -->
        <!-- features_path und atomDescriptors format=unknown    wegen beidem mal mit jana zusammen setzen--> 
        <section title="Input Data" name="input-data" expanded="true">  
            <param argument="--checkpoint_path" type="data" format="zip" optional="true" help="Model checkpoint as .zip"/>
            <!-- <param argument="\-\-data_path" type="data" format="csv" optional="true" help="CSV file containing testing data for which predictions will be made"/> -->
            <param argument="--test_path" type="data" format="csv" optional="true" help="CSV file with smiles"/> 
            <param argument="--smiles_columns" type="text" optional="true" help="List of names of the columns containing SMILES strings. Insert the numbers of the columns separated with ','">
                <validator type="regex" message="bullshit">^[a-zA-Z0-9._-]*$</validator>
            </param>
        </section>
        <section title="Advanced Settings" name="advanced_settings" expanded="true"> 
            <param argument="--empty_cache" type="boolean" optional="true" help="Whether to empty all caches before training or predicting. This is necessary if multiple jobs are run within a single script and the atom or bond features change"/>
            <param argument="--no_cache" type="boolean" optional="true" help="Turn off caching mol2graph computation"/> 
            <param argument="--no_cache_mol" type="boolean" optional="true" help="Whether to not cache the RDKit molecule for each SMILES string to reduce memory usage cached by default"/>
            
            <param argument="--no_features_scaling" type="boolean" optional="true" value="False" help="Turn off scaling of features"/>
            <!-- atom_descriptors UND atom_descriptors_path müssen entweder beide gesetzt werden oder dürfen gar nicht im wrap autauchen (egal ob feature oder descriptor ausgewählt ist)-->
            <!-- <param argument="\-\-atom_descriptors" type="select" help="Use atom descriptors."> 
                <option value="feature">Feature</option>
                <option value="descriptor" selected="true">Descriptor</option>
            </param>
            <param argument="\-\-atom_descriptors_path" type="data" format="csv" help="File with extra atom descriptors"/> -->
            
            
            <param argument="--bond_features_size" type="integer" min="1" optional="true" help="Size of the extra bond descriptors that will be used as bond features to featurize a given molecule." />
            <param argument="--batch_size" type="integer" label="Batch Size" optional="true" value="50" help="Batch size for training." />
        </section>
    </inputs>
    <outputs>
        <data name="outputFile" label="${tool.name} on ${on_string}: predicted values" format="csv" from_work_dir="DMPNN_preds.csv"/>
    </outputs>
    <tests>
        <test>
            <section name="input-data">
                <!-- <param name="data_path" value="S_dataset.csv"/> -->
                <param name="test_path" value="smiles.csv"/>
                <param name="checkpoint_path" value="dmpnn-random/fold_0/model_0/model.pt"/> 
                <param name="smiles_columns" value="smiles"/>
            </section>
            <section name="advanced_settings">
                <param name="empty_cache" value="true"/>
                <param name="no_cache" value="true"/>
                <param name="no_cache_mol" value="true"/>
                 
                
                <!-- <param name="atom_descriptors" value="descriptor"/> -->
                <param name="no_features_scaling" value="false"/>
                <param name="bond_features_size" value="100"/>
                <param name="batch_size" value="32"/>

            </section>
            
            <output name="outputFile">
                <assert_contents>
                    <has_n_lines n="7"/>
                    <has_n_columns n="8" sep=","/>
                    <has_text text="smiles,AR,ER,GR,Aromatase,TR,PPARg,ED"/>
                </assert_contents>
            </output>
            <assert_stdout>
                <has_text text="Saving predictions"/>
            </assert_stdout>
        </test>
    </tests>
    <help><![CDATA[
    kommt noch
    ]]></help>
    <expand macro="citations"/>
</tool>