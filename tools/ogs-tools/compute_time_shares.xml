<tool id="compute_time_shares" name="Compute Time Shares" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <description>
        This tool processes a log file, extracts time data, and outputs the cumulative values. Optionally, the output can also be saved in JSON format.
      </description>
    <requirements> 
        <requirement type="package" version="3.9">python</requirement>
        <requirement type="package" version="1.9.1">argparse</requirement>
        <requirement type="package" version="3.8">subprocess</requirement>
        <requirement type="package" version="3.9">shlex</requirement>
        <requirement type="package" version="2.0.9">json</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python3 compute_time_shares.py --in_file "$in_file" --json-out "$json_out" --quite "$quite"
    ]]></command>
    <inputs>
        <param argument="in_file" type="text" optional="false" label="in_file"/>
        <param argument="--json-out" type="boolean" truevalue="--json-out" falsevalue="" checked="false" label="json_out"/>
        <param argument="--quiet" type="boolean" truevalue="--quiet" falsevalue="" checked="false" label="quiet"/>

    </inputs>
    <outputs>
        <data name="summary" format="txt" label="Summary Output" />
      <data name="json_output" format="json" label="JSON Output" />
    </outputs>
    <tests>
        <test>
            <param name="in_file" value="test_file.txt"/>
            <param name="json_out" value="true"/>
            <param name="quiet" value="false"/>
            <output name="summary" file="test_output.txt"/>
            <output name="json_output" file="test_output.json"/>
        </test>
    </tests>
    
    <help><![CDATA[
       This tool processes a log file to compute and aggregate time data by category. It extracts lines containing the keyword `[time]`, calculates cumulative times for each category, and can optionally save the results in a JSON file.

        **Parameters:**
        - **Input File (`in_file`)**: The log file containing time information. The script looks for lines with the keyword `[time]`.
        - **Output JSON File (`json_out`)**: If selected, results will be saved in a JSON file named by appending `_total_timings.json` to the input filename.
        - **Suppress Console Output (`quiet`)**: If selected, the console output is suppressed and only the JSON file (if `json_out` is enabled) will be generated.

        **Functionality:**
        - The script extracts and aggregates time data from the input file.
        - Cumulative times for each category are calculated.
        - Results are either printed to the console or saved in a JSON file based on the selected options.

        **Notes:**
        - If the `quiet` option is enabled, only the JSON output will be generated and no console output will be displayed.
           ]]></help>
    <citations>
        <citation type="doi">UFZ</citation>
    </citations>
</tool>