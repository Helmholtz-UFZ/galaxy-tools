<tool id="map_boundary_to_bulk" name="Map Boundary To Bulk" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <description>
        This tool maps the nodes of a boundary mesh to the corresponding nodes of a bulk mesh. 
        The output is a mesh with a `bulk_node_ids` field, which can be used in OGS for specifying inhomogeneous boundary conditions.
    </description>
    <requirements>
        <requirement type="package" version="5.9.0">pvpython</requirement>
        <requirement type="package" version="5.9.1">paraview</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
    pvpython map-boundary-to-bulk.py --bulk "$bulk" --boundary "$boundary" --output "$output"
     ]]></command>
    <inputs>
        <param argument="--bulk" type="text" optional="false" label="bulk"/>
        <param argument="--boundary" type="text" optional="false" label="boundary"/>
        <param argument="--output" type="text" optional="false" label="output"/>

    </inputs>
    <outputs>
        <data name="output_data" format="vtu" label="Mapped Boundary Mesh"/>
    </outputs>
    <tests>
        <test>
            <param name="bulk" value="test_data/bulk_mesh.vtu"/>
            <param name="boundary" value="test_data/boundary_mesh.vtu"/>
            <param name="output" value="test_data/mapped_boundary_output.vtu"/>
            
            <output name="output_data" file="test_data/expected_mapped_boundary_output.vtu" compare="diff"/>
        </test>
    </tests>
    <help><![CDATA[
        This tool maps the nodes of a boundary mesh to the corresponding nodes of a bulk mesh. It reads two VTU files, one for the boundary mesh and one for the bulk mesh, and adds a nodal field to the boundary mesh to indicate which bulk mesh nodes correspond to each boundary node.

        **Inputs:**
        - **Bulk Mesh (`--bulk`)**: The VTU file containing the bulk mesh data. This mesh serves as the reference for mapping boundary nodes.
        - **Boundary Mesh (`--boundary`)**: The VTU file containing the boundary mesh data. The nodes in this mesh will be mapped to the nodes in the bulk mesh.
        - **Output File (`--output`)**: The VTU file that will be generated after processing. This file will include the boundary mesh with an added nodal field indicating the corresponding bulk mesh node IDs.

        **Functionality:**
        - Reads the input VTU files for both the bulk and boundary meshes.
        - Maps the coordinates of boundary mesh nodes to the corresponding bulk mesh nodes. 
        - Adds a nodal field named `bulk_node_ids` to the boundary mesh. This field maps each boundary node to its corresponding bulk mesh node ID.
        - The resulting output mesh can be used in applications like OGS (OpenGeoSys) to specify boundary conditions along surfaces.

        **Notes:**
        - Both meshes must conform to each other, meaning the coordinates in the boundary mesh must exactly match the coordinates in the bulk mesh (bit-wise). The script does not apply any tolerance for coordinate matching.
        - Ensure that the boundary mesh coordinates align exactly with those of the bulk mesh to avoid errors in mapping.

        **Output:**
        - The output VTU file will contain the boundary mesh with an additional nodal field, `bulk_node_ids`, mapping boundary nodes to their corresponding bulk nodes.
    ]]></help>
    <citations>
        <citation type="doi">Ahrens, James, Geveci, Berk, Law, Charles, ParaView: An End-User Tool for Large Data Visualization, Visualization Handbook, Elsevier, 2005, ISBN-13: 9780123875822</citation>
    </citations>
</tool>

