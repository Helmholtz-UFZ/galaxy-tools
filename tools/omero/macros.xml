<macros>
    <!-- for historic reasons the omero-py version is used as the version for all tools -->
    <token name="@TOOL_VERSION@">5.18.0</token>
    <token name="@EZOMERO_VERSION@">3.0.1</token>
    <token name="@PROFILE@">25.1</token>

    <xml name="ezomero_requirements">
        <requirements>
            <requirement type="package" version="@EZOMERO_VERSION@">ezomero</requirement>
            <requirement type="package" version="2.2.2">pandas</requirement>
            <yield/>
        </requirements>
    </xml>

    <xml name="omeropy_requirements">
        <requirements>
            <requirement type="package" version="@TOOL_VERSION@">omero-py</requirement>
            <!-- openjdk is needed: https://github.com/conda-forge/omero-py-feedstock/pull/16 -->
            <requirement type="package" version="21.0.2">openjdk</requirement>
            <yield/>
        </requirements>
    </xml>

    <xml name="omero_credentials">
        <credentials name="OMERO" version="0.1" label="OMERO Credentials" description="Input a set of credentials to access a target OMERO.server">
            <variable name="username" inject_as_env="OMERO_USER" optional="true" label="OMERO username" description="OMERO username" />
            <secret name="password" inject_as_env="OMERO_PASSWORD" optional="true" label="OMERO password" description="OMERO password" />
            <secret name="uuid-key" inject_as_env="UUID_SESSION_KEY" optional="true" label="OMERO UUID Session Key" description="Input your session key here to connect using an existing OMERO session key. More information on how to find a session key: https://omero.readthedocs.io/en/stable/users/cli/sessions.html" />
        </credentials>
    </xml>

    <xml name="host_port">
        <param name="omero_host" type="text" label="OMERO host URL">
            <validator type="regex" message="Enter a valid host location, for example, your.omero.server">^[a-zA-Z0-9._-]*$</validator>
            <validator type="expression" message="No two dots (..) allowed">'..' not in value</validator>
        </param>
        <param argument="omero_port" type="integer" optional="false" value="4064" label="OMERO port"/>
        <param name="test_username" type="hidden" value=""/>
        <param name="test_password" type="hidden" value=""/>
        <conditional name="session_id">
            <param name="session_id_input" type="select" label="Create an OMERO session using a UUID key?" help="Connect to OMERO trough an existing connection (no password/username input)">
                <option value="no">No</option>
                <option value="yes">Yes</option>
            </param>
            <when value="yes">
                <param name="close_connection" type="boolean" truevalue="True" falsevalue="False" label="Close the connection after executing the tool?"
                help="If yes, the current OMERO connection will be closed after tools execution. UUID key cannot be used again in further tools."/>
            </when>
            <when value="no">
            </when>
        </conditional>
    </xml>
    <token name="@HOST_PORT@">
        --host '$omero_host'
        --port $omero_port
    </token>

    <token name="@SECURITY_DISCLAIMER@">
    To use the OMERO tools, you **MUST** trust the Galaxy instance and its administrators.

	Your OMERO username and password will be stored temporarily in the job directory. This directory exists (1) during the execution of the job and (2) may remain accessible after the job ran (depending on the Galaxy's configuration). In both 		cases, the folder can be accessed by users with administrative privileges.

	Please be aware: your username and password may be visible to users with administrative rights. The creators of the OMERO tools do not take responsibility for any potential password exposure. We strongly recommend using a temporary token or the UUID session option instead of your main credentials.

	We are actively working on improving the security of the OMERO suite.
    </token>

</macros>